/* biome-ignore-file: Tailwind v4 @theme tokens unsupported by current Biome */

/*************************************************************/
/* Font Face Declarations */
/*************************************************************/

/* PolySans - Variable */
@font-face {
  font-family: "PolySans";
  font-style: normal;
  font-weight: 100 900;
  font-display: swap;
  src: url("/fonts/PolySans-variable.woff2") format("woff2");
}

/* PolySans - Variable Italic */
@font-face {
  font-family: "PolySans";
  font-style: italic;
  font-weight: 100 900;
  font-display: swap;
  src: url("/fonts/PolySansItalic-variable.woff2") format("woff2");
}

/* Inter - Regular */
@font-face {
  font-family: "Inter";
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url("/fonts/Inter-Regular.woff2") format("woff2");
}

/* Inter - Regular Italic */
@font-face {
  font-family: "Inter";
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: url("/fonts/Inter-Italic.woff2") format("woff2");
}

/* Inter - SemiBold */
@font-face {
  font-family: "Inter";
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: url("/fonts/Inter-SemiBold.woff2") format("woff2");
}

/* Inter - SemiBold Italic */
@font-face {
  font-family: "Inter";
  font-style: italic;
  font-weight: 600;
  font-display: swap;
  src: url("/fonts/Inter-SemiBoldItalic.woff2") format("woff2");
}

/* JetBrains Mono - Regular */
@font-face {
  font-family: "JetBrains Mono";
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url("/fonts/JetBrainsMono-Regular.woff2") format("woff2");
}

/* JetBrains Mono - Regular Italic */
@font-face {
  font-family: "JetBrains Mono";
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: url("/fonts/JetBrainsMono-Italic.woff2") format("woff2");
}

/* JetBrains Mono - SemiBold */
@font-face {
  font-family: "JetBrains Mono";
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: url("/fonts/JetBrainsMono-SemiBold.woff2") format("woff2");
}

/* JetBrains Mono - SemiBold Italic */
@font-face {
  font-family: "JetBrains Mono";
  font-style: italic;
  font-weight: 600;
  font-display: swap;
  src: url("/fonts/JetBrainsMono-SemiBoldItalic.woff2") format("woff2");
}

/*************************************************************/
/* Tailwind setup */
/*************************************************************/

@import "tailwindcss" source(".");

@theme {
  /* Typography */
  --font-sans:
    "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
    "Helvetica Neue", Arial, sans-serif;
  --font-heading:
    "PolySans", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
    "Helvetica Neue", Arial, sans-serif;
  --font-mono:
    "JetBrains Mono", "ui-monospace", "SFMono-Regular", '"Roboto Mono"',
    '"Courier New"', "monospace";
  --text-2xs: 0.625rem;

  /* Breakpoints */
  --breakpoint-xs: 30rem;
  --breakpoint-3xl: 110rem;
  --breakpoint-4xl: 120rem;

  /* Animations */
  @keyframes blink {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0;
    }
  }

  --animate-blink: blink 1s steps(1, end) infinite;

  /* Layout */
  --grid-template-rows-layout: 1fr auto;
}

@plugin "@tailwindcss/typography";

@custom-variant dark (&:where(.dark, .dark *));

/*************************************************************/
/* Base styles */
/*************************************************************/

html {
  height: 100%;
}
body {
  min-height: 100dvh;
  overflow-x: hidden;
  overscroll-behavior-x: none;
  background-color: var(--color-white);
  @apply font-sans text-sm bg-white dark:bg-gray-950;
}

/*************************************************************/
/* CSS Conventions & Guidelines */
/*************************************************************/

/*
 * Border Radius Convention:
 * - rounded-sm (2px)  - Interactive elements, focus rings, buttons, small UI
 * - rounded-md (6px)  - Cards, containers, grid items, larger surfaces
 * - rounded-full      - Pills, badges, circular icons, avatar-style elements
 *
 * Color Scale Convention:
 * Primary (Indigo):
 *   - 600/400: Link default colors (light/dark mode)
 *   - 500: Interactive states, borders, focus rings
 *   - 300/700: Hover states (dark/light mode)
 *
 * Neutrals (Gray):
 *   - 400/500: Muted/secondary text
 *   - 900/100: Primary text (light/dark mode)
 *   - 950/50: Background colors (dark/light mode)
 *
 * Font Weight Convention:
 *   - Only 400 (regular) and 600 (semibold) weights are loaded
 *   - Use font-semibold for bold text (not font-bold)
 *   - Matches loaded font files for optimal performance
 *
 * Markdown Alerts:
 *   - Uses vanilla CSS with color-mix() for opacity control
 *   - Provides GitHub-style alerts with semantic colors
 *   - Isolated pattern that doesn't leak into components
 */

/*************************************************************/
/* Reusable Utility Classes */
/*************************************************************/

/* Focus ring for interactive elements */
@utility focus-ring-primary {
  outline: none;
  &:focus-visible {
    @apply ring-2 ring-indigo-500 ring-offset-2 dark:ring-offset-gray-950 rounded-sm;
  }
}

/* Link color utilities */
@utility link-primary {
  @apply text-indigo-600 hover:text-indigo-500 focus-visible:text-indigo-500 dark:text-indigo-400 dark:hover:text-indigo-300 dark:focus-visible:text-indigo-300;
}

@utility link-secondary {
  @apply text-gray-500 hover:text-gray-700 focus-visible:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 dark:focus-visible:text-gray-300;
}

/*************************************************************/
/* Focus styles */
/*************************************************************/

/* Note: Legacy comment - focus styles now use @utility focus-ring-primary */

:root {
  --code-branding-light: #4C4CDD;
  --code-branding-dark: #03060E;
}

/*************************************************************/
/* Syntax highlighting */
/*************************************************************/

.shiki,
.shiki span {
  color: var(--shiki-light) !important;
}

html.dark .shiki,
html.dark .shiki span {
  color: var(--shiki-dark) !important;
}

.shiki:focus-visible {
  outline: none;
  border-radius: 2px;
  @apply ring-4 ring-offset-2 ring-indigo-100 bg-indigo-100 ring-offset-indigo-100 dark:ring-indigo-900 dark:bg-indigo-900 dark:ring-offset-indigo-900;
}

/*************************************************************/
/* Markdown alerts */
/*************************************************************/

:root {
  --github-alert-default-color: var(--color-gray-500);
  --github-alert-note-color: var(--color-blue-500);
  --github-alert-tip-color: var(--color-green-500);
  --github-alert-important-color: var(--color-indigo-500);
  --github-alert-warning-color: var(--color-yellow-500);
  --github-alert-caution-color: var(--color-red-500);
}

@media (prefers-color-scheme: dark) {
  :root {
    --github-alert-default-color: var(--color-gray-500);
    --github-alert-note-color: var(--color-blue-500);
    --github-alert-tip-color: var(--color-green-500);
    --github-alert-important-color: var(--color-indigo-500);
    --github-alert-warning-color: var(--color-yellow-500);
    --github-alert-caution-color: var(--color-red-500);
  }
}

.markdown-alert {
  padding: 1rem;
  margin: 1rem 0;
  border: 1px solid var(--github-alert-default-color);
  font-family: var(--font-mono);
  font-size: 0.875rem;
  @apply rounded-sm;
}

.markdown-alert .octicon {
  display: inline-block;
  fill: currentColor;
}

.markdown-alert > :first-child {
  margin-top: 0;
}

.markdown-alert > :last-child {
  margin-bottom: 0;
}

.markdown-alert > * {
  margin: 0;
}

.markdown-alert-note {
  border-color: color-mix(in srgb, var(--github-alert-note-color) 30%, transparent);
  color: var(--github-alert-note-color);
  background-color: color-mix(in srgb, var(--github-alert-note-color) 10%, transparent);
}

.markdown-alert-tip {
  border-color: color-mix(in srgb, var(--github-alert-tip-color) 30%, transparent);
  color: var(--github-alert-tip-color);
}

.markdown-alert-important {
  border-color: color-mix(in srgb, var(--github-alert-important-color) 30%, transparent);
  color: var(--github-alert-important-color);
}

.markdown-alert-warning {
  border-color: color-mix(in srgb, var(--github-alert-warning-color) 30%, transparent);
  color: var(--github-alert-warning-color);
}

.markdown-alert-caution {
  border-color: var(--github-alert-caution-color);
  color: var(--github-alert-caution-color);
}

.markdown-alert-title {
  display: flex;
  align-items: center;
}

.markdown-alert-title > svg {
  margin-right: 0.5rem;
}

.markdown-alert-note .markdown-alert-title {
  color: var(--github-alert-note-color);
}

.markdown-alert-tip .markdown-alert-title {
  color: var(--github-alert-tip-color);
}

.markdown-alert-important .markdown-alert-title {
  color: var(--github-alert-important-color);
}

.markdown-alert-warning .markdown-alert-title {
  color: var(--github-alert-warning-color);
}

.markdown-alert-caution .markdown-alert-title {
  color: var(--github-alert-caution-color);
}

/*************************************************************/
/* Post styles */
/*************************************************************/

/* Base prose setup with content width constraints */
@utility post-prose {
  @apply prose dark:prose-invert max-w-none text-pretty border border-transparent sm:px-4 text-lg;
  @apply [&>*:not(.code)]:max-w-[calc(var(--container-4xl)-1rem-2px)];
  @apply [&>:first-child]:mt-0 [&>:last-child]:mb-0 leading-8;
}

/* Heading typography and hash prefixes */
@utility post-headings {
  @apply prose-headings:font-mono prose-headings:text-lg;
  @apply prose-h1:before:content-['#'] prose-h2:before:content-['##'] prose-h3:before:content-['###'];
  @apply prose-h4:before:content-['####'] prose-h5:before:content-['#####'] prose-h6:before:content-['######'];
  @apply prose-headings:before:mr-2 prose-headings:before:tracking-widest prose-headings:before:text-indigo-400;
}

/* Heading borders and spacing */
@utility post-heading-borders {
  @apply prose-h1:border-b-2 prose-h2:border-b;
  @apply prose-h1:border-indigo-500 prose-h2:border-indigo-500;
  @apply prose-h1:pb-4 prose-h1:mb-4 prose-h2:pb-4 prose-h2:mb-4 prose-h3:mb-5;
  @apply prose-h1:mt-16 prose-h2:mt-12 prose-h3:mt-12;
}

/* Link styling with decorations and focus states */
@utility post-links {
  @apply prose-a:font-mono;
  @apply prose-a:text-indigo-600 dark:prose-a:text-indigo-300;
  @apply prose-a:underline prose-a:hover:underline;
  @apply prose-a:decoration-indigo-200 dark:prose-a:decoration-indigo-900;
  @apply prose-a:hover:decoration-current prose-a:focus-visible:decoration-current;
  @apply prose-a:underline-offset-4;
  @apply prose-a:outline-none prose-a:focus-visible:ring-2 prose-a:focus-visible:ring-indigo-500;
  @apply prose-a:focus-visible:ring-offset-2 dark:prose-a:focus-visible:ring-offset-gray-950;
  @apply prose-a:rounded-sm prose-a:text-wrap prose-a:break-words prose-a:[word-break:break-word];
}

/* Composed post class for backward compatibility */
.post {
  @apply post-prose post-headings post-heading-borders post-links sm:my-8;
}

@utility prose {
  blockquote {
    /* Disable adding quote marks to block-quotes: https://github.com/tailwindlabs/tailwindcss-typography/issues/66 */
    p {
        &:first-of-type::before,
        &:last-of-type::after {
            content: none;
        }
    }
  }
}

/*************************************************************/
/* Code styles */
/*************************************************************/

.code {
	@apply overflow-x-scroll max-w-[calc(100vw)] -mx-4 sm:-mx-12 border-y border-gray-200 dark:border-gray-700/50 dark:bg-gray-900/50 bg-gray-50 text-gray-400 [&>*]:mx-8 sm:[&>*]:mx-12 [&>*]:inline-block;
}

/*************************************************************/
/* Text styles */
/*************************************************************/

strong {
  @apply font-semibold;
}

/*************************************************************/
/* Sandpack */
/*************************************************************/

/* code has child .custom-wrapper focus within */
.code:has(.sp-cm:focus-visible) {
  @apply ring-2 ring-indigo-500 ring-offset-2 dark:ring-offset-gray-950 rounded-sm;
}
.code .custom-wrapper {
  @apply subpixel-antialiased;
}

.code .custom-layout {
  @apply border-none rounded-none overflow-visible;
}

.code .custom-layout,
.code .custom-editor,
.code .custom-code-editor,
.code .custom-preview,
.code .cm-editor {
  @apply !bg-transparent;
}

.code .custom-pre-placeholder {
  @apply not-md:px-3!;
}

.code .custom-preview {
  @apply md:max-w-[300px] shadow-md border-none border-r border-gray-200 dark:border-gray-700 bg-black;
}

.code .custom-preview-iframe {
  @apply bg-gray-100 dark:bg-gray-900;
}

.code .cm-scroller > * {
  @apply px-7 sm:px-11 md:px-4;
}

.code .cm-content,
.code .cm-editor {
  @apply text-lg! leading-7!;
}

/*************************************************************/
/* Command styles */
/*************************************************************/

.command + .markdown-alert {
  @apply mt-0.5;
}

/*************************************************************/
/* Nav block hover effects */
/*************************************************************/

/* When any nav-block is hovered or focused, fade OTHER nav-blocks to 50% */
.nav-blocks-grid:has(.nav-block:hover, .nav-block:focus-visible) > .nav-block:not(:hover):not(:focus-visible) {
  opacity: 0.8;
}

/*************************************************************/
/* View Transitions */
/*************************************************************/

/*
 * View Transition API configuration for smooth page transitions
 * Supports morphing between index grid and post page
 */

/* Root transition - old disappears instantly, new fades in */
::view-transition-old(root) {
  animation: none;
  opacity: 0;
}

::view-transition-new(root) {
  animation: fade-in 0.3s ease-out;
}

/* Custom animation for post visuals (images/videos) */
::view-transition-old(post-visual),
::view-transition-new(post-visual) {
  /* Maintain aspect ratio during transition */
  object-fit: cover;
  overflow: clip;
  mix-blend-mode: normal;
}

/* Completely disable group morphing for post visual */
::view-transition-group(post-visual) {
  /* No morphing animation at all */
  animation: none !important;
}

/* New visual slides down from top and fades in */
::view-transition-new(post-visual) {
  animation: slideFromTop 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) 0.1s both,
             fade-in 0.7s ease-out 0.1s both;
  opacity: 0;
  transform: translateY(-200px);
}

@keyframes slideFromTop {
  from {
    transform: translateY(-200px);
  }
  to {
    transform: translateY(0);
  }
}

@keyframes fade-out {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}

@keyframes fade-in {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes slideUpFade {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Post content elements - old disappears instantly, new fades in staggered */
::view-transition-old(post-breadcrumb),
::view-transition-old(post-metadata),
::view-transition-old(post-content),
::view-transition-old(post-warning),
::view-transition-old(post-visual) {
  animation: none;
  opacity: 0;
}

::view-transition-new(post-breadcrumb) {
  animation: slideUpFade 0.5s ease-out 0.2s both;
}

::view-transition-new(post-metadata) {
  animation: slideUpFade 0.5s ease-out 0.3s both;
}

::view-transition-new(post-warning) {
  animation: slideUpFade 0.5s ease-out 0.4s both;
}

::view-transition-new(post-content) {
  animation: slideUpFade 0.5s ease-out 0.4s both;
}

/* Keep navigation fixed and prevent flickering during transitions */
::view-transition-old(navigation),
::view-transition-new(navigation) {
  /* Keep navigation instantly visible with no animation */
  animation: none;
  mix-blend-mode: normal;
}

/* Ensure navigation group doesn't animate and stays on top */
::view-transition-group(navigation) {
  animation-duration: 0s;
  z-index: 9999;
}

/* Accessibility: Respect user's motion preferences */
@media (prefers-reduced-motion: reduce) {
  ::view-transition-old(*),
  ::view-transition-new(*) {
    animation: none !important;
    animation-delay: 0s !important;
  }

  ::view-transition-group(*) {
    animation-duration: 0s !important;
  }
}